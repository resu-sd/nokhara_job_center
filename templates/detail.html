{% extends "base.html" %}
{% load static %} 
{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="{% static 'css/detail.css' %}" />
{% endblock extra_css %} {% block sharing_card %}
<meta
	name="description"
	content="{{ job.description|truncatechars_html:150 }}" />
<meta property="og:url" content="https://hehenischal.pythonanywhere.com/" />
<meta property="og:type" content="website" />
<meta
	property="og:title"
	content="{{ job.title|capfirst }} | Pokhara Jobs Center" />
<meta
	property="og:description"
	content="{{ job.description|truncatechars_html:150 }}" />
<meta
	property="og:image"
	content="https://hehenischal.pythonanywhere.com/static/images/og-image.jpg" />
<!-- Twitter Meta Tags -->
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:domain" content="hehenischal.pythonanywhere.com" />
<meta
	property="twitter:url"
	content="https://hehenischal.pythonanywhere.com/" />
<meta
	name="twitter:title"
	content=" {{ job.title|capfirst }} | Pokhara Jobs Center" />
<meta
	name="twitter:description"
	content="{{ job.description|truncatechars_html:150 }}" />
<meta
	name="twitter:image"
	content="https://hehenischal.pythonanywhere.com/static/images/og-image.jpg" />
{% endblock sharing_card %}

{% block content %}

<main>
	<div class="container-detail">
		<section class="job-detail">
			<h2>{{ job.title|capfirst }}</h2>
			<div class="job-meta">
				<p><span>Location:</span> {{ job.location|capfirst }}</p>
				<p><span>Salary Range:</span> {{ job.salary_range }}</p>
				<p><span>Status:</span> {{ job.job_type|capfirst }}</p>
				<p>
					<span>Published Date:</span> {{ job.created_at|date:"Y-m-d"}}
				</p>
				<p>
					<span>Expiry Date:</span> {{ job.expiry_date|date:"Y-m-d" }}
				</p>
				<p>
					<span>Created By:</span> {{ job.created_by.username|default:"admin" }}
				</p>
			</div>

			<div class="job-info">
				<h3>Job Description</h3>
				<p>{{ job.description|safe }}</p>

				<h3>Requirements</h3>
				<ul>
					{% for req in requirements %}
					<li>{{ req.text }}</li>
					{% empty %}
					<li>No requirements listed.</li>
					{% endfor %}
				</ul>

				<h3>Benefits</h3>
				<ul>
					{% for ben in benefits %}
					<li>{{ ben.text }}</li>
					{% empty %}
					<li>No benefits listed.</li>
					{% endfor %}
				</ul>

				<button
					class="apply-btn"
					data-bs-toggle="modal"
					data-bs-target="#choiceModal">
					Apply Now
				</button>
			</div>
		</section>
	</div>
</main>

<!-- Modals -->
<div class="modal fade" id="choiceModal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content text-center">
			<div class="modal-header">
				<h5 class="modal-title">How would you like to apply?</h5>
				<button class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<button
					class="btn btn-primary btn-sm mb-2 w-100"
					onclick="openApplyForm()">
					Submit Application
				</button>
				<button
					class="btn btn-success btn-sm w-100"
					onclick="openOfficeInfo()">
					Visit Office
				</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="applyFormModal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Submit Application</h5>
				<button class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<form id="applyForm" method="POST">
				{% csrf_token %}
				<input type="hidden" name="job" value="{{ job.id }}" />
				<div class="modal-body">
					<div class="mb-3">
						<label class="form-label">Full Name</label>
						<input
							type="text"
							class="form-control"
							name="full_name"
							required />
					</div>
					<div class="mb-3">
						<label class="form-label">Email</label>
						<input
							type="email"
							class="form-control"
							name="email"
							required />
					</div>
					<div class="mb-3">
						<label class="form-label">Address</label>
						<textarea
							class="form-control"
							rows="2"
							name="address"
							required></textarea>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success w-100">
						Submit
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" id="officeModal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Visit Our Office</h5>
				<button class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<div class="office-info">
					<p><strong>Job ID:</strong> {{ job.id }}</p>
					<p><strong>Office:</strong>Pokhara Jobs Center</p>
					<p><strong>Address:</strong>Amarsingh Chowk, Pokhara</p>
					<p>Please bring your CV and documents.</p>
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary w-100" data-bs-dismiss="modal">
					Got it!
				</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="successModal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content text-center">
			<div class="modal-header">
				<h5 class="modal-title">Application Sent!</h5>
				<button class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<p>Your application has been submitted successfully.</p>
			</div>
			<div class="modal-footer">
				<button class="btn btn-primary w-100" data-bs-dismiss="modal">
					Close
				</button>
			</div>
		</div>
	</div>
</div>
{% endblock content %}


{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
<script>
	document
		.getElementById("menuToggle")
		.addEventListener("click", function () {
			document.getElementById("navLinks").classList.toggle("show");
		});

	document.addEventListener("click", function (event) {
		const navLinks = document.getElementById("navLinks");
		const menuToggle = document.getElementById("menuToggle");

		if (
			window.innerWidth <= 768 &&
			navLinks.classList.contains("show") &&
			!navLinks.contains(event.target) &&
			!menuToggle.contains(event.target)
		) {
			navLinks.classList.remove("show");
		}
	});

	function openApplyForm() {
		bootstrap.Modal.getInstance(
			document.getElementById("choiceModal")
		).hide();
		new bootstrap.Modal(document.getElementById("applyFormModal")).show();
	}

	function openOfficeInfo() {
		bootstrap.Modal.getInstance(
			document.getElementById("choiceModal")
		).hide();
		new bootstrap.Modal(document.getElementById("officeModal")).show();
	}

	document
		.getElementById("applyForm")
		.addEventListener("submit", function (e) {
			e.preventDefault();

			const formData = new FormData(this);

			fetch("", {
				method: "POST",
				body: formData,
				headers: {
					"X-CSRFToken": formData.get("csrfmiddlewaretoken"),
				},
			})
				.then((response) => response.json())
				.then((data) => {
					if (data.status === "success") {
						bootstrap.Modal.getInstance(
							document.getElementById("applyFormModal")
						).hide();

						new bootstrap.Modal(
							document.getElementById("successModal")
						).show();

						this.reset();
					} else {
						alert("Error: " + data.message);
					}
				})
				.catch((error) => {
					console.error("Error:", error);
					alert("Something went wrong. Please try again.");
				});
		});
</script>
{% endblock extra_js %}
